<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
     <link rel="icon" type="image/png" href="/static/images/logo.png">
  <title>Choose Your Avatar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <script src="https://kit.fontawesome.com/83eb50da7d.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0f172a;
      --bg2:#0b1222;
      --ink:#eaf2ff;
      --muted:#e1e7f2;
      --brand:#70aeff;
      --brand2:#447be9;
      --ok:#22c55e;
      --card:#0e1628;
      --glow: 0 10px 30px rgba(68,123,233,.35);
      --ring: 0 0 0 2px rgba(68,123,233,.55), 0 0 0 8px rgba(68,123,233,.12);
    }

    *{box-sizing:border-box}
    body{
      margin:0; min-height:100dvh;
      /* background: radial-gradient(1200px 600px at 10% -10%, #1e293b 0%, #0f172a 35%, #0b1222 100%); */
       /* background: linear-gradient(90deg, #70aeff, #5792f1, #447be9, #3e75eb); */
      color:var(--ink);
      font-family:"Nunito Sans", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      display:flex; align-items:center; justify-content:center;
      padding: clamp(16px, 4vw, 40px);
    }

    .wrap{
      width:min(1080px, 96vw);
    }

    .head{
      text-align:center; margin-bottom:28px;
    }
    .head h1{
      font-size: clamp(22px, 3.2vw, 34px);
      margin:0 0 8px;
      letter-spacing:.2px;
      color:black;
    }
    .head p{
      margin:0; color:black;
    }

    .grid{
      display:grid; gap:18px;
      grid-template-columns: repeat(4, minmax(0,1fr));
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    }
    @media (max-width: 520px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      position:relative;
      background: linear-gradient(180deg, #0f1b33, var(--card));
      border-radius:16px; overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
      transition: transform .25s ease, box-shadow .25s ease, filter .25s ease;
      cursor:pointer;
      isolation:isolate;
      padding: 15px 10px 5px 10px;
    }
    .card:hover{
      transform: translateY(-8px) rotateX(1.2deg) rotateY(-1.2deg);
      box-shadow: var(--glow);
      filter: brightness(1.06);
    }

    .art{
      position:relative;
      height: 320px;
      display:grid; place-items:center;
      overflow:hidden;
    }
    .art img{
      width:100%; height:100%; object-fit:cover;
      transform-origin:center;
      transition: transform .35s ease;
    }
    .card:hover .art img{
      transform: scale(1.06) translateY(-4px);
    }

    /* groove/bounce */
    @keyframes groove {
      0%   { transform: translateY(0) rotate(0deg) }
      50%  { transform: translateY(-6px) rotate(-.4deg) }
      100% { transform: translateY(0) rotate(0deg) }
    }
    .card:hover .art { animation: groove 1.2s ease-in-out infinite; }

    .title{
      padding:12px 14px 16px;
      font-weight:800;
      color:black;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    .title span{
      color:black;
      font-size: 1rem;
    }

    /* selection ring + check */
    .ring{
      position:absolute; inset:0; border-radius:16px; pointer-events:none;
      box-shadow:none; transition: box-shadow .2s ease;
    }
    .check{
      position:absolute; top:10px; right:10px;
      width:34px; height:34px; border-radius:10px;
      background:#0b1222cc; color:#fff; display:grid; place-items:center;
      opacity:0; transform: scale(.9);
      transition: opacity .18s ease, transform .18s ease, background .2s ease;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.08);
    }
    .card.selected .ring{ box-shadow: var(--ring); }
    .card.selected .check{ opacity:1; transform: scale(1); background:#16a34acc; } /* green-ish */

    /* toast */
    .toast{
      position:fixed; bottom:24px; left:50%; transform: translateX(-50%) translateY(20px);
      background:#0d1526; color:#eaf2ff; padding:10px 14px; border-radius:12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      opacity:0; pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
      z-index:50;
    }
    .toast.show{ opacity:1; transform: translateX(-50%) translateY(0); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="head">
      <h1>Pick your vibe</h1>
      <p>Choose an avatar to personalize your NeuroHarmony experience.</p>
    </div>
<br><br>
    <div class="grid" id="avatar-grid">
      <!-- Card 1 -->
      <article class="card" data-avatar="pop_princess" aria-label="Pop Princess" tabindex="0">
        <div class="art">
          <img src="/static/images/pop_princess.png" alt="Pop Princess">
        </div>
        <div class="title">
          <span>Pop Princess</span>
          <i class="fa-solid fa-music"></i>
        </div>
        <div class="ring"></div>
        <div class="check"><i class="fa-solid fa-check"></i></div>
      </article>

      <!-- Card 2 -->
      <article class="card" data-avatar="goth_rock_emo" aria-label="Goth Rock Emo" tabindex="0">
        <div class="art">
          <img src="/static/images/goth_rock_emo.png" alt="Goth Rock Emo">
        </div>
        <div class="title">
          <span>Goth Rock Emo</span>
          <i class="fa-solid fa-skull"></i>
        </div>
        <div class="ring"></div>
        <div class="check"><i class="fa-solid fa-check"></i></div>
      </article>

      <!-- Card 3 -->
      <article class="card" data-avatar="dance_party_edm" aria-label="Dance Party EDM" tabindex="0">
        <div class="art">
          <img src="/static/images/dance_party_edm.png" alt="Dance Party EDM">
        </div>
        <div class="title">
          <span>Dance Party EDM</span>
          <i class="fa-solid fa-bolt"></i>
        </div>
        <div class="ring"></div>
        <div class="check"><i class="fa-solid fa-check"></i></div>
      </article>

      <!-- Card 4 -->
      <article class="card" data-avatar="mid_west_country_girl" aria-label="Mid West Country Girl" tabindex="0">
        <div class="art">
          <img src="/static/images/mid_west_country_girl.png" alt="Mid West Country Girl">
        </div>
        <div class="title">
          <span>Mid West Country Girl</span>
          <i class="fa-solid fa-cow"></i>
        </div>
        <div class="ring"></div>
        <div class="check"><i class="fa-solid fa-check"></i></div>
      </article>
    </div>
  </div>

  <div class="toast" id="toast">Avatar saved! Taking you to your music…</div>

  <script>
    const grid = document.getElementById('avatar-grid');
    const toast = document.getElementById('toast');

    function showToast(msg='Saved!'){
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(()=> toast.classList.remove('show'), 1800);
    }

    function selectCard(card){
      document.querySelectorAll('.card').forEach(c=> c.classList.remove('selected'));
      card.classList.add('selected');
    }

    async function saveAvatar(key){
      try{
        const res = await fetch('/choose_avatar', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ avatar: key })
        });

        if (res.redirected){
          // if session expired, backend may redirect to login_page
          window.location = res.url;
          return;
        }

        if (!res.ok){
          const t = await res.text().catch(()=> 'Error');
          showToast('Could not save avatar');
          console.error(t);
          return;
        }

        // success
        showToast('Avatar saved! Taking you to your music…');
        const data = await res.json().catch(()=> ({}));
        const next = (data && data.next) ? data.next : '/listen_now';
        setTimeout(()=> window.location = next, 700);
      }catch(err){
        console.error(err);
        showToast('Network error');
      }
    }

    // Click & keyboard interactions
    grid.addEventListener('click', (e)=>{
      const card = e.target.closest('.card');
      if (!card) return;
      selectCard(card);
      saveAvatar(card.dataset.avatar);
    });

    grid.addEventListener('keydown', (e)=>{
      const card = e.target.closest('.card');
      if (!card) return;
      if (e.key === 'Enter' || e.key === ' '){
        e.preventDefault();
        selectCard(card);
        saveAvatar(card.dataset.avatar);
      }
    });
  </script>
</body>
</html>
